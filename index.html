<!DOCTYPE html>
<html>

  <head>
    <!-- Basic stuff -->    
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="app_framework/css/af.ui.min.css">
    <link rel="stylesheet" type="text/css" href="app_framework/css/icons.min.css">
    <link rel="stylesheet" type="text/css" href="css/index_main.less.css" class="main-less">
    <link rel="stylesheet" type="text/css" href="css/mashery.css">
    <link rel="stylesheet" type="text/css" href="css/moosic.css">
    <title>Moosic</title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; minimum-scale=1.0; user-scalable=0;">
    <style type="text/css">
      /* Prevent copy paste for all elements except text fields */
              *  { -webkit-user-select:none; -webkit-tap-highlight-color:rgba(255, 255, 255, 0); }
              input, textarea  { -webkit-user-select:text; }
    </style>
    <script src="intelxdk.js"></script>
    <script type="text/javascript" charset="utf-8" src="xhr.js"></script>      
    <script type="application/javascript" src="app_framework/appframework.min.js"></script>
    <script type="application/javascript" src="app_framework/appframework.ui.min.js"></script>
      
      <!-- Required if packaging to native app using Intel XDK -->    
    <script src="intelxdk.js"></script>
    <script src="xhr.js"></script>
    <script>    
        function onDeviceReady(){ 
            $.ui.launch();
            intel.xdk.device.hideSplashScreen();
        }
        document.addEventListener("intel.xdk.device.ready", onDeviceReady, false);
    </script>
    <!-- End basic stuff -->    

      
    <script>   
        $.ui.autoLaunch = false; 
        $.ui.backButtonText = "Back";
    
        $(document).ready(function(){
            $.ui.launch();
            // setup signin and signup button events
            $("#login").on("click", function(){
                signIn();
            });
        });
                
        function signIn(){
            // sigin code here
            $.ui.loadContent("main", null, null, "fade");
//            document.addEventListener("intel.xdk.facebook.login",function(e){ 
//                if (e.success == true) { 
//                    console.log("Facebook Log in Successful"); } 
//                else{ 
//                    console.log("Unsuccessful Login"); } 
//            },false); 
//            intel.xdk.facebook.login("publish_stream,publish_actions,offline_access"); 
        }
                
        function signUp(){
            // signup code here
            $.ui.loadContent("main", null, null, "fade");
        }   
                
        function startApp(){
            // clears all back button history
            $.ui.clearHistory();  
            // your app code here
        }
    </script>   
  </head>
    
              
<body> 
<div id="afui">
    
    <div id="content" style=""> 
        
    <!-- Views -->
        
        <!-- Welcome View -->
        <div class="panel" title="Welcome" id="page1" data-header="none" data-footer="none" selected="true">
            <div style="text-align:center">
            <br>
            <br>
            <h1>Welcome to Moosic!</h1>
            <br>
            <br>
            <h6>Powered by:</h6>
            <img src="http://cdn3.rd.io/user/press/rdio-logo-thumb.png" id="rdiologo" class="logo">
            <img src="http://content.developer.mashery.com.s3.amazonaws.com/xdk-demos/masherymade.png" id="masherylogo" class="logo">
            <img src="http://xdk-software.intel.com/images/intel_xdk_logo.png" id="masherylogo" class="logo">
            <br>
            <br>
            <p>Moosic will detect how your feeling based on your latest Facebook status update and stream the perfect music to match your mood.</p>
            <br>
            <br>
            </div>    
            <ul class="list inset">
                <li><a href="#signin" class="icon user" style="text-align:center">Login with Facebook</a></li>
            </ul>
        </div>
        
        <!-- Login View -->
        <div class="panel" title="Login" id="signin" data-footer="none">
            <div style="text-align:center">
            <br>
            <br>
            <p>Please log in to Facebook with your account information</p>
            <br>
            <br>
            </div>
            <input name="username" type="text" placeholder="username" />
            <input name="password" type="password" placeholder="password" />
            <a class="button block green" href="#" id="login">Login with Facebook</a>
        </div>
        
        <!-- Main App View -->
        <div class="panel" title="Your moosic choice" id="main" data-load="startApp">
            <script src="intelxdk.js"></script>
            <script type="text/javascript" charset="utf-8" src="xhr.js"></script>      
            <script type="application/javascript" src="app_framework/appframework.min.js"></script>
            <script type="application/javascript" src="app_framework/appframework.ui.min.js"></script>
            <script type="application/javascript" src="js/jquery.rdio.js"></script>

            <script>
              $(document).ready(function(){
                var message = "My boyfriend just dumped me on valentine's day :'(";
                alert("message: " + message);

                // replace all spaces in the message with plus signs
                var find = ' ';
                var re = new RegExp(find, 'g');
                msg_str = message.replace(re, '+');

                var key = "k6sTu56WlU39YVOkfZLpG2Odb48";
                var URL = "http://uclassify.com/browse/prfekt/Mood/ClassifyText?readkey=" + key + "&text=" + msg_str + "&output=json&version=1.01";

                $.ajax({
                  type: "GET",
                  dataType: "json",
                  url: URL,
                  data: "",
                  contentType: 'application/json; charset=utf-8',
                  success: function(data) {
                    alert("success");
                    var mood = "happy";
                    $.each(data, function(key, val) {
                      if (key === "cls1") {  // val = (prob of happy, prob of upset)
                        var p_happy = -1;
                        $.each(val, function(k, v) {
                          if (p_happy < 0) {
                            p_happy = v;
                          }
                        });
                        if (p_happy < 0.5) {
                          mood = "sad";
                        }
                      }
                    });
                    alert("mood: " + mood);

                    //var obj = $.parseJSON(data);
                    //alert( obj.toString() );

                    // do stuff with the mood
                  },
                  error: function(jqXHR, textStatus, errorThrown) {
                    alert(textStatus, errorThrown);
                  }
                });
              });

              function initRdio() {
                // TODO
              }
            </script>
                
            <div id="player">
              <img src="img/play.png" id="playButton" class="playerBtn">
              <img src="img/pause.png" id="pauseButton" class="playerBtn">
            </div>
                
            
            <script>
                $("#playButton").click(function() {
                    alert("play button called");

                    var key = "k6sTu56WlU39YVOkfZLpG2Odb48";
                    var URL = "http://uclassify.com/browse/prfekt/Mood/ClassifyText?readkey=" + key + "&text=" + msg_str + "&version=1.01";  // TODO UPDATE URL

                    $.ajax({
                      type: "GET",
                      dataType: "json",
                      url: URL,
                      data: "",
                      contentType: 'application/json; charset=utf-8',
                      success: function(data) {
                        var array = data;
                        var mood = array[0];
                        var array_str = array.toString();
                        var mood_str = mood.toString();
                        alert("mood_str: " + mood_str);
                        alert("array_str: " + array_str);
                        // do stuff with the mood
                      }
                    );

                    $('#player').rdio().play(songId);
                });
                
                $('#pauseButton').click(function() {
                    alert("pause button called");
                    $('#player').rdio().pause();
                });

            </script>

        </div>
        
    </div>

</div>
</body>
</html>
